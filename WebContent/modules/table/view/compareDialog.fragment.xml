<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core" >
  <Dialog
      title="Списки показателей для сравнения и сопоставления"
      class="sapUiPopupWithPadding">
    <content>
      <IconTabBar expandable="false">
        <items>
          <IconTabFilter
            text="Показатели для сравнения"
            icon="sap-icon://column-chart-dual-axis">
            <NavContainer
              id="compareContainer"
              width="600px"
              height="620px">
              <Page id="compareList" showHeader="true">
                <headerContent>
                  <Button
                    text="Добавить показатель для сравнения"
                    icon="sap-icon://sys-add"
                    iconFirst="false"
                    press="handleCompareItemAdd">
                    <customData>
                      <core:CustomData key="target" value="compareItemEdit"/>
                    </customData>
                  </Button>
                </headerContent>
                <content>
                  <ScrollContainer
                    horizontal="false"
                    vertical="true"
                    height="500px">
                      <List
                        mode="Delete"
                        noDataText="Список пуст"
                        type="Navigation"
                        delete="handleCompareItemDelete"
                        items="{gSettings>/compareList}">
                        <DisplayListItem
                          label="{gSettings>label}"
                          value="{
                            path: 'gSettings>type',
                            formatter: '.compareItemTypeFormatter'
                          }"
                          type="Navigation"
                          press="handleСompareItemPress">
                        </DisplayListItem>
                      </List>
                  </ScrollContainer>
                </content>
              </Page>
              <Page
                id="compareItemEdit"
                showNavButton="true"
                title="Редактирование показателя для сравнения"
                navButtonPress="handleCompareContainerNavBack">
                <VBox class="sapUiSmallMargin">
                  <Label text="Выбор показателя:"/>
                  <ComboBox
                    id="compareIndsList"
                    width="100%"
                    selectedKey="{gSettings>measure}"
                    selectionChange="handleCompareMeasureChange"
                    items="{gSelectedInds>/}">
                    <core:Item
                      key="{gSelectedInds>INDCD}"
                      text="{
                        parts: [
                          'gSelectedInds>INDCD',
                          'gSelectedInds>FNAME'
                        ],
                        formatter: '.measureSelectFormatter'
                      }"
                    />
                  </ComboBox>
                  <Label text="Название:"/>
                  <Input value="{gSettings>label}"/>
                  <l:HorizontalLayout >
                    <Label class="sapUiSmallMarginTop" text="Скрыть в таблице:"/>
                    <CheckBox selected="{gSettings>hideInTbl}"/>
                  </l:HorizontalLayout>
                  <l:HorizontalLayout >
                    <Label class="sapUiSmallMarginTop" text="Вариант вывода:"/>
                    <ComboBox
                      class="sapUiTinyMarginBegin"
                      selectionChange=".onChangePosition"
                      selectedKey="{
                        path: 'gSettings>position',
                        formatter: '.getVariantOutput'
                      }"
                    >
                      <items>
                        <core:Item key="cols" text="В колонках" />
                        <core:Item key="rows" text="В строках" />
                        <core:Item key="all" text="В колонках и в строках" />
                      </items>
                    </ComboBox>
                  </l:HorizontalLayout>
                </VBox>
                <!-- <VBox class="sapUiSmallMargin">
                  <Label text="Тип сравнения:"/>
                  <ComboBox
                    selectedKey="{gSettings>type}"
                    width="100%">
                    <core:Item key="FIX" text="Фиксированное значение" />
                    <core:Item key="AGG" text="Агрегация по измерению" />
                  </ComboBox>
                </VBox>
                <VBox
                  class="sapUiSmallMargin"
                  visible="{= ${gSettings>type} === 'AGG' }">
                  <Label text="Выбор измерения:"/>
                  <ComboBox
                    id="compareObjDimension"
                    selectedKey="{gSettings>dimension}"
                    width="100%"
                    items="{gSettings>/table/dialogColumns}">
                    <core:Item key="{gSettings>textFields/0}" text="{gSettings>label}" />
                  </ComboBox>
                </VBox> -->
                <VBox
                  class="sapUiSmallMargin"
                  visible="{= ${gSettings>type} === 'FIX' }">
                  <Label text="Выбор фильтров:" design="Bold"/>

                  <VBox class="sapUiSmallMargin">
                      <Label text="Период" />
                      <MultiComboBox
                        id="comparePeriodFilter"
                        selectedKeys="{gSettings>filters/0/values}"
                        items="{compareFilters>/CALYEAR/}">
                        <items>
                          <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                        </items>
                        <customData>
                          <core:CustomData key="filter" value="CALYEAR"/>
                        </customData>
                      </MultiComboBox>

                      <Panel
                        id="extendedCompareFilterPanel"
                        expandable="true"
                        expanded="false"
                        headerText="Дополнительные фильтры"
                        width="auto"
                        class="sapUiSmallMargin">
                        <Label text="Бизнес-cфера" />
                        <MultiComboBox
                          selectedKeys="{gSettings>filters/1/values}"
                          items="{compareFilters>/PERS_AREA/}">
                          <items>
                            <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                          </items>
                          <customData>
                            <core:CustomData key="filter" value="PERS_AREA"/>
                          </customData>
                        </MultiComboBox>

                        <Label text="Категории сотрудников" />
                        <MultiComboBox
                          selectedKeys="{gSettings>filters/2/values}"
                          items="{compareFilters>/EMPLSGROUP/}">
                          <items>
                            <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                          </items>
                          <customData>
                            <core:CustomData key="filter" value="EMPLSGROUP"/>
                          </customData>
                        </MultiComboBox>

                        <Label text="Функциональная группа персонала" />
                        <MultiComboBox
                          selectedKeys="{gSettings>filters/3/values}"
                          items="{compareFilters>/_BIC_ZOTZ_FUGR/}">
                          <items>
                            <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                          </items>
                          <customData>
                            <core:CustomData key="filter" value="_BIC_ZOTZ_FUGR"/>
                          </customData>
                        </MultiComboBox>

                        <Label text="Группировка МО" />
                        <MultiComboBox
                          selectedKeys="{gSettings>filters/4/values}"
                          items="{compareFilters>/_BIC_ZHRGRPMO/}">
                          <items>
                            <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                          </items>
                          <customData>
                            <core:CustomData key="filter" value="_BIC_ZHRGRPMO"/>
                          </customData>
                        </MultiComboBox>

                        <Label text="Версия" />
                        <MultiComboBox
                          selectedKeys="{gSettings>filters/5/values}"
                          items="{compareFilters>/_BIC_ZVARIANT/}">
                          <items>
                            <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                          </items>
                          <customData>
                            <core:CustomData key="filter" value="_BIC_ZVARIANT"/>
                          </customData>
                        </MultiComboBox>

                        <Label text="Функция управления" />
                        <MultiComboBox
                          selectedKeys="{gSettings>filters/7/values}"
                          items="{compareFilters>/CNTRLFNC/}">
                          <items>
                            <core:Item key="{compareFilters>key}" text="{compareFilters>text}"/>
                          </items>
                          <customData>
                            <core:CustomData key="filter" value="CNTRLFNC"/>
                          </customData>
                        </MultiComboBox>
                      </Panel>
                  </VBox>
                </VBox>
              </Page>
            </NavContainer>
          </IconTabFilter>

          <IconTabFilter
            text="Показатели для сопоставления"
            icon="sap-icon://business-objects-experience">

            <NavContainer
              id="collationContainer"
              width="600px"
              height="620px">
              <Page id="collationList" showHeader="true">
                <headerContent>
                  <Button
                    text="Добавить показатель для сопоставления"
                    icon="sap-icon://sys-add"
                    iconFirst="false"
                    press="handleCollationItemAdd">
                    <customData>
                      <core:CustomData key="target" value="collationItemEdit"/>
                    </customData>
                  </Button>
                </headerContent>
                <content>
                  <ScrollContainer
                    horizontal="false"
                    vertical="true"
                    height="500px">
                      <List
                        mode="Delete"
                        noDataText="Список пуст"
                        type="Navigation"
                        delete="handleCollationItemDelete"
                        items="{gSettings>/collationList}">
                        <DisplayListItem
                          label="{gSettings>label}"
                          value=""
                          type="Navigation"
                          press="handleCollationItemPress">
                        </DisplayListItem>
                    </List>
                  </ScrollContainer>
                </content>
              </Page>
              <Page
                id="collationItemEdit"
                title="Редактирование показателя для сопоставления"
                showNavButton="true"
                navButtonPress="handleCollationContainerNavBack">
                <VBox class="sapUiSmallMargin">
                  <Label text="Выбор объемного показателя:"/>
                  <ComboBox
                    width="100%"
                    selectedKey="{gSettings>measure}"
                    selectionChange="handleCollationMeasureChange"
                    items="{collationDicts>/main/}">
                    <core:Item
                      key="{collationDicts>INDCD}"
                      text="{
                        parts: [
                          'collationDicts>INDCD',
                          'collationDicts>FNAME'
                        ],
                        formatter: '.measureSelectFormatter'
                      }"
                    />
                  </ComboBox>
                  <Label text="Название:"/>
                  <Input value="{gSettings>label}"/>
                  <l:HorizontalLayout >
                    <Label class="sapUiSmallMarginTop" text="Скрыть в таблице:"/>
                    <CheckBox selected="{gSettings>hideInTbl}"/>
                  </l:HorizontalLayout>
                  <l:HorizontalLayout >
                    <Label class="sapUiSmallMarginTop" text="Вариант вывода:"/>
                    <ComboBox
                        class="sapUiTinyMarginBegin"
                        selectionChange=".onChangePosition"
                        selectedKey="{
                          path: 'gSettings>position',
                          formatter: '.getVariantOutput'
                        }"
                    >
                      <items>
                        <core:Item key="cols" text="В колонках" />
                        <core:Item key="rows" text="В строках" />
                        <core:Item key="all" text="В колонках и в строках" />
                      </items>
                    </ComboBox>
                  </l:HorizontalLayout>
                </VBox>
                <VBox>
                  <Table
                    id="collationTable"
                    items="{gSettings>collation}">
                  <columns>
                    <Column width="50px">
                      <Text text="Период"/>
                    </Column>
                    <Column>
                      <Text text="Показатель ССЧ"/>
                    </Column>
                    <Column width="10px"/>
                  </columns>
                  <items>
                    <ColumnListItem>
                      <Text text="{gSettings>period}"/>
                      <ComboBox
                        width="100%"
                        items="{collationDicts>/coll/}"
                        selectedKey="{gSettings>measure}">
                        <core:Item
                          key="{collationDicts>INDCD}"
                          text="{
                            parts: [
                              'collationDicts>INDCD',
                              'collationDicts>FNAME'
                            ],
                            formatter: '.measureSelectFormatter'
                          }"
                        />
                      </ComboBox>
                      <core:Icon
                        class="collationMeasureResetIcon"
                        src="sap-icon://sys-cancel-2"
                        tooltip="Сбросить показатель"
                        visible="{= ${gSettings>measure} !== '' }"
                        press="handleCollationMeasureReset"/>
                    </ColumnListItem>
                  </items>
                </Table>
                </VBox>
              </Page>
            </NavContainer>


          </IconTabFilter>
        </items>
      </IconTabBar>
    </content>
    <beginButton>
      <Button text="Применить" press="handleCompareDialogApply" />
    </beginButton>
    <endButton>
      <Button text="Отмена" press="handleCompareDialogClose" />
    </endButton>

  </Dialog>
</core:FragmentDefinition>
