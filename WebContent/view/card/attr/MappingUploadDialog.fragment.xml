<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:u="sap.ui.unified"
    xmlns:f="sap.ui.layout.form"
    xmlns:table="sap.ui.table">
    <Dialog title="Массовая загрузка из файла" stretch="true" class="sapUiContentPadding" busyIndicatorDelay="0">
        <content>
            <VBox>
                <u:FileUploader
                    id="fileUploader"
                    sendXHR="true"
                    useMultipart="false"
                    buttonOnly="false"
                    fileType="xlsx"
                    buttonText="Обзор ..."
                    change="onMappingUploadFileChange"
                    width="100%"
                    sameFilenameAllowed="true"
                    uploadComplete="onMappingUploadComplete"
                    typeMissmatch="onMappingUploadTypeMissmatch"
                    style="Emphasized"/>
                <HBox class="sapUiTinyMarginTop">
                    <Link text="Скачать шаблон" href="etc/MappingUploadTemplate.xlsx"/>
                    <core:Icon
                        src="sap-icon://sys-help"
                        press="showMappingUploadHelpDialog"
                        tooltip="Подсказка по заполнению"
                        class="sapUiTinyMarginBegin"/>
                </HBox>

                <table:Table
                    id="tableUploads"
                    selectionMode="None"
                    selectionBehavior="RowOnly"
                    rows="{upload>/}"
                    visibleRowCount="15"
                    class="sapUiSmallMarginTop"
                    visible="false"
                    showNoData="false">
                    <table:toolbar>
                        <Toolbar>
                            <ToggleButton
                                id="buttonHideColumns"
                                icon="sap-icon://exit-full-screen"
                                press="showOrHideUnnecessaryColumns"
                                tooltip="Компактый/полный режим отображения"/>
                            <Text id="uploadCountOK" visible="false"/>
                            <Text id="uploadCountRewrite" visible="false"/>
                            <Text id="uploadCountError" visible="false"/>
                            <ToolbarSpacer/>
                            <!-- <Button id="buttonUploadSave" text="Сохранить" press="onUploadSave" type="Accept"/> -->
                        </Toolbar>
                    </table:toolbar>
                    <table:columns>
                        <table:Column hAlign="Center">
                            <table:template>
                                <core:Icon
                                    src="sap-icon://overlay"
                                    tooltip="{upload>statusText}"
                                    color="{
                                        path: 'upload>status',
                                        formatter: '.formatter.getColorForUploadStatus'
                                    }"/>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderAttr">
                            <table:multiLabels>
                                <Label text="Атрибут" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Название" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>attrName}" tooltip="{upload>attrNameStatusText}">
                                    <!-- Зачем это: смотри css-файл -->
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>attrNameStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column>
                            <table:multiLabels>
                                <Label text="Атрибут"/>
                                <Label text="Описание" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>attrDescr}" tooltip="{upload>attrDescrStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>attrDescrStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderField" visible="{visibleColumns>/fieldKey}">
                            <table:multiLabels>
                                <Label text="Техническое поле" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Ключ" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>fieldKey}" tooltip="{upload>fieldKeyStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>fieldKeyStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column visible="{visibleColumns>/fieldValueShort}">
                            <table:multiLabels>
                                <Label text="Техническое поле" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Краткий текст" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>fieldValueShort}" tooltip="{upload>fieldValueShortStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>fieldValueShortStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column visible="{visibleColumns>/fieldValueMedium}">
                            <table:multiLabels>
                                <Label text="Техническое поле" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Средний текст" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>fieldValueMedium}" tooltip="{upload>fieldValueMediumStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>fieldValueMediumStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column visible="{visibleColumns>/fieldValueFull}">
                            <table:multiLabels>
                                <Label text="Техническое поле" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Полный текст" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>fieldValueFull}" tooltip="{upload>fieldValueFullStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>fieldValueFullStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column visible="{visibleColumns>/fieldValueDefault}">
                            <table:multiLabels>
                                <Label text="Техническое поле" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Текст по умолчанию" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>fieldValueDefault}" tooltip="{upload>fieldValueDefaultStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>fieldValueDefaultStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderDict1" visible="{visibleColumns>/dictId}">
                            <table:multiLabels>
                                <Label text="Справочник" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="ID" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>dictId}" tooltip="{upload>dictIdStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>dictIdStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderDict2" visible="{visibleColumns>/dictKey}">
                            <table:multiLabels>
                                <Label text="Справочник" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Ключ" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>dictKey}" tooltip="{upload>dictKeytStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>dictKeyStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderDict3" visible="{visibleColumns>/dictValueShort}">
                            <table:multiLabels>
                                <Label text="Справочник" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Краткий текст" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>dictValueShort}" tooltip="{upload>dictValueShortStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>dictValueShortStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderDict4" visible="{visibleColumns>/dictValueMedium}">
                            <table:multiLabels>
                                <Label text="Справочник" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Средний текст" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>dictValueMedium}" tooltip="{upload>dictValueMediumStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>dictValueMediumStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderDict5" visible="{visibleColumns>/dictValueFull}">
                            <table:multiLabels>
                                <Label text="Справочник" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Полный текст" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>dictValueFull}" tooltip="{upload>dictValueFullStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>dictValueFullStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                        <table:Column id="multiheaderDict6" visible="{visibleColumns>/dictValueDefault}">
                            <table:multiLabels>
                                <Label text="Справочник" textAlign="Center" width="100%" design="Bold"/>
                                <Label text="Текст по умолчанию" textAlign="Center" width="100%"/>
                            </table:multiLabels>
                            <table:template>
                                <Text text="{upload>dictValueDefault}" tooltip="{upload>dictValueDefaultStatusText}">
                                    <customData>
                                        <core:CustomData
                                            key="mapping-upload-class"
                                            value="{
                                                path: 'upload>dictValueDefaultStatus',
                                                formatter: '.formatter.getClassColorForUploadStatus'
                                            }"
                                            writeToDom="true"/>
                                    </customData>
                                </Text>
                            </table:template>
                        </table:Column>
                    </table:columns>
                </table:Table>
            </VBox>
        </content>
        <buttons>
            <Button id="buttonSave" text="Сохранить" type="Accept" press="onMappingUploadDialogSave" enabled="false"/>
            <Button text="Закрыть" press="closeMappingUploadDialog"/>
        </buttons>
    </Dialog>
</core:FragmentDefinition>
