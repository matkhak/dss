<mvc:View
    controllerName="controller.calc.createOrEdit"
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:control="control"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:mvc="sap.ui.core.mvc">
    <App>
    
        <Page
            id="idPage"
            title="Создание варианта расчёта"
            class="sapUiContentPadding"

            busyIndicatorDelay="0">
            <headerContent>
                <Button icon="sap-icon://home" tooltip="Вернуться в стартовое меню Репозитрия" press="onReturnStartPage"/>
                <ToolbarSeparator/>
            </headerContent>
            <content>
                <IconTabBar
                    id="idIconTabBar"
                    expandable="false"
                    select="handleIconTabBarSelect"
                    class="sapUiResponsiveContentPadding"
                    backgroundDesign="Transparent">
                    <items>
                        <IconTabFilter
                            id="tab1"
                            icon="sap-icon://puzzle"
                            iconColor="Neutral"
                            design="Horizontal"
                            count="1"
                            text="Описание"
                            key="BO">
                            <FlexBox alignItems="Start" justifyContent="Center">
                                <VBox class="sapUiLargeMarginEnd">
                                    <Label text="Название" required="true"/>
                                    <Input id="inputName" width="35em" liveChange="inputNameLiveChange" editable="{editable>/editable}"/>
                                    <Label text="Описание" class="sapUiSmallMarginTop" required="true"/>
                                    <TextArea
                                        id="inputDescription"
                                        width="35em"
                                        height="132px"
                                        liveChange="inputDescLiveChange"
                                        editable="{editable>/editable}"/>
                                    <Label text="Показатель" class="sapUiSmallMarginTop"/>
                                    <Input
                                        id="inputIndicator"
                                        type="Text"
                                        placeholder="Выбрать показатель"
                                        showValueHelp="true"
                                        valueHelpOnly="true"
                                        valueHelpRequest="addIndicatorHelp"
                                        editable="{editable>/editable}"/>
                                    <Label text="Кратность" class="sapUiSmallMarginTop" />
                                    <Select id="sDigit"   items="{digits>/}" forceSelection="false" width="35em" enabled="{editable>/editable}">
                                        <core:Item key="{digits>code}" text="{digits>name}"/>
                                    </Select>
                                     <Label text="Единица измерения" class="sapUiSmallMarginTop" />
                                    <Input
                                        id="inputUnit"
                                        type="Text"
                                        editable="false"/>
                                    <f:SimpleForm id="formEditInfo" title="Последнее изменение">
                                        <f:content>
                                            <Label text="Дата"/>
                                            <Text id="editDate"/>
                                            <Label text="Автор"/>
                                            <Text id="editAuthor"/>
                                        </f:content>
                                    </f:SimpleForm>
                                   
                                </VBox>
                                <VBox>
                                    <Label text="Информационная модель" required="true"/>
                                    <Select
                                        id="sIAS"
                                        items="{infoModels>/}"
                                        forceSelection="false"
                                        width="35em"
                                        change="onInfoModelChange"
                                        enabled="{editable>/editable}">
                                        <core:Item key="{infoModels>codeValue}" text="{infoModels>name}"/>
                                    </Select>
                                    <Label text="Бизнес-объект" class="sapUiSmallMarginTop" required="true"/>
                                    <Select
                                        id="sBO"
                                        items="{objects>/}"
                                        forceSelection="false"
                                        width="35em"
                                        change="onObjectChange"
                                        enabled="{editable>/editable}">
                                        <core:Item key="{objects>iId}:{objects>iVersion}" text="{objects>sName}"/>
                                    </Select>
                                    <Label text="Мера" class="sapUiSmallMarginTop" required="true"/>
                                    <Select id="sMera" items="{mera>/}" forceSelection="false" width="35em" enabled="{editable>/editable}">
                                        <core:Item key="{mera>iId}" text="{mera>sName}"/>
                                    </Select>
                                    <Label text="Функция" class="sapUiSmallMarginTop" required="true"/>
                                    <Select id="sFunction" items="{functions>/}" forceSelection="false" width="35em" enabled="{editable>/editable}">
                                        <core:Item key="{functions>code}" text="{functions>name}"/>
                                    </Select>
                                    <Label text="Ответственная служба" class="sapUiSmallMarginTop" required="true"/>
                                    <Select
                                        id="sRespService"
                                        items="{respService>/}"
                                        forceSelection="false"
                                        width="35em"
                                        change="onRespServiceChange"
                                        enabled="{editable>/editable}">
                                        <core:Item key="{respService>ID}" text="{respService>NAME}"/>
                                    </Select>
                                    <Label text="Ответственный специалист" class="sapUiSmallMarginTop"/>
                                    <Input
                                        id="idInputRespPerson"
                                        type="Text"
                                        placeholder="Выбрать ответственного"
                                        showValueHelp="true"
                                        valueHelpOnly="true"
                                        valueHelpRequest="responsPersonHelp"
                                        editable="{editable>/editable}"/>
                                </VBox>
                            </FlexBox>
                        </IconTabFilter>
                        <IconTabSeparator icon="sap-icon://begin"/>
                        <IconTabFilter
                            id="tab2"
                            icon="sap-icon://chart-axis"
                            iconColor="Neutral"
                            design="Horizontal"
                            count="2"
                            text="Аналитики"
                            key="Ind">
                            <FlexBox alignItems="Center" justifyContent="Center">
                                <l:HorizontalLayout>
                                    <VBox alignItems="Center" >
                                        <Label text="Доступные аналитики" class="sapUiSmallMarginBegin"/>
                                         <SearchField
                                            class="sapUiSmallMargin"
                                         	width="250px"
                                         	liveChange="onSearchAnalsForAdding"
          								 />
                                        <ScrollContainer
                                            height="350px"
                                            width="250px"
                                            class="sapUiSmallMargin"
                                            horizontal="false"
                                            vertical="true"
                                            focusable="true">
                                            <SelectList
                                                id="lAnalytics"
                                                class="sapUiSmallMarginBottom"
                                                items="{analytic>/}"
                                                enabled="{editable>/editable}">
                                                <core:Item key="{analytic>iId}" text="{analytic>sName}"/>
                                            </SelectList>
                                        </ScrollContainer>
                                    </VBox>
                                    <VBox>
                                        <Button
                                            id="buttonAddAnal"
                                            class="sapUiLargeMarginTop"
                                            icon="sap-icon://navigation-right-arrow"
                                            press="onPressAddAnal"
                                            visible="{editable>/editable}"/>
                                        <Button
                                            id="buttonDeleteAnal"
                                            class="sapUiTinyMarginTop"
                                            icon="sap-icon://navigation-left-arrow"
                                            press="onPressDelAnal"
                                            visible="{editable>/editable}"/>
                                        <Button
                                            id="buttonDeleteAllAnal"
                                            class="sapUiLargeMarginTop"
                                            icon="sap-icon://media-rewind"
                                            press="onPressDelAllAnal"
                                            visible="{editable>/editable}"/>
                                        <Button
                                            id="buttonAddAllAnal"
                                            class="sapUiTinyMarginTop"
                                            icon="sap-icon://media-forward"
                                            press="onPressAddAllAnal"
                                            visible="{editable>/editable}"/>
                                    </VBox>
                                    <VBox>
                                        <Label text="Выбранные аналитики" class="sapUiSmallMarginBegin"/>
                                        <ScrollContainer
                                            height="350px"
                                            width="250px"
                                            class="sapUiSmallMargin"
                                            horizontal="false"
                                            vertical="true"
                                            focusable="true">
                                            <SelectList
                                                id="lSelectedAnalitics"
                                                class="sapUiSmallMarginBottom"
                                                items="{sel-analytic>/}"
                                                enabled="{editable>/editable}">
                                                <core:Item key="{sel-analytic>iId}" text="{sel-analytic>sName}"/>
                                            </SelectList>
                                        </ScrollContainer>
                                    </VBox>
                                </l:HorizontalLayout>
                            </FlexBox>
                        </IconTabFilter>
                        <IconTabSeparator icon="sap-icon://begin"/>
                        <IconTabFilter
                            id="tab3"
                            icon="sap-icon://filter"
                            iconColor="Neutral"
                            design="Horizontal"
                            count="3"
                            text="Ограничения"
                            key="Attr">
                            <FlexBox alignItems="Center" justifyContent="Center">
                                <l:HorizontalLayout>
                                    <VBox alignItems="Center" >
                                        <Label text="Доступные атрибуты" class="sapUiSmallMarginBegin"/>
                                        <SearchField
                                        width="340px"
          									liveChange="onSearchAttrForFilters"
          								 />
                                        <ScrollContainer height="350px" horizontal="false" vertical="true" class="sapUiSmallMargin" focusable="true">
                                            <SelectList id="slAttrForRestrict" items="{restrict>/}" enabled="{editable>/editable}">
                                                <core:Item key="{restrict>iId}" text="{restrict>sName}"/>
                                            </SelectList>
                                        </ScrollContainer>
                                    </VBox>
                                    <VBox>
                                        <Button
                                            id="buttonAddRestrict"
                                            class="sapUiLargeMarginTop"
                                            icon="sap-icon://navigation-right-arrow"
                                            press="onPressAttrForRestrict"
                                            visible="{editable>/editable}"/>
                                        <Button
                                            id="buttonDeleteRestrict"
                                            class="sapUiTinyMarginTop"
                                            icon="sap-icon://navigation-left-arrow"
                                            press="onPressDelAttrRestrict"
                                            visible="{editable>/editable}"/>
                                        <Button
                                            id="buttonDeleteAllRestricts"
                                            class="sapUiLargeMarginTop"
                                            icon="sap-icon://media-rewind"
                                            press="onPressDelAllRestricts"
                                            visible="{editable>/editable}"/>
                                        <Button
                                            id="buttonAddAllRestricts"
                                            class="sapUiTinyMarginTop"
                                            icon="sap-icon://media-forward"
                                            press="onPressAddAllRestricts"
                                            visible="{editable>/editable}"/>
                                    </VBox>
                                    <VBox>
                                        <Label text="Атрибут" class="sapUiSmallMarginBegin"/>
                                        <ScrollContainer height="350px" horizontal="false" vertical="true" class="sapUiSmallMargin" focusable="true">
                                            <SelectList
                                                id="slAttrRestricted"
                                                items="{sel-restrict>/}"
                                                selectionChange="onPressAttrRestricted">
                                                <core:Item key="{sel-restrict>iId}" text="{sel-restrict>sName}"/>
                                            </SelectList>
                                        </ScrollContainer>
                                    </VBox>
                                    <VBox>
                                        <Label text="Ограничения на выбранный атрибут" class="sapUiSmallMarginBegin"/>
                                        <l:VerticalLayout id="vertLayoutRestrictions" class="sapUiSmallMargin"/>
                                    </VBox>
                                </l:HorizontalLayout>
                            </FlexBox>
                        </IconTabFilter>
                        <IconTabSeparator icon="sap-icon://begin"/>
                        <IconTabFilter icon="sap-icon://complete" iconColor="Neutral" design="Horizontal" count="4" text="Итог" key="Final">
                            <Panel headerText="Основная информация" expandable="true" expanded="true">
                                <Label text="Бизнес-объект"/>
                                <Input id="p4BO" enabled="true" editable="false"/>
                                <Label text="Показатель"/>
                                <Input id="p4IND" enabled="true" editable="false"/>
                                <Label text="Мера"/>
                                <Input id="p4Measure" enabled="true" editable="false"/>
                                <Label text="Функция"/>
                                <Input id="p4Func" enabled="true" editable="false"/>
                            </Panel>

                            <Panel headerText="Аналитики" expandable="true" expanded="true">
                                <headerToolbar>
                                    <Toolbar height="3rem">
                                        <Title text="Аналитики" level="H4"/>
                                        <ToggleButton id="idBtnSearchShow" icon="sap-icon://search" press="onPressBtnSearchShow"/>
                                        <SearchField visible="false" id="idSearchField" width="20%" liveChange="liveFilterTokenAnalytics"/>
                                    </Toolbar>
                                </headerToolbar>

                                <Tokenizer id="idTokenizer" width="100%" editable="false" tokens="{sel-analytic>/}">
                                    <Token text="{sel-analytic>sName}" editable="false"/>
                                </Tokenizer>
                            </Panel>

                            <Panel headerText="Ограничения" expandable="true" expanded="true">
                                <Table id="tableFinal" items="{/}">
                                    <columns>
                                        <Column mergeDuplicates="true" width="6em">
                                            <header>
                                                <Text text="Атрибут"/>
                                            </header>
                                        </Column>
                                        <Column width="2em">
                                            <header>
                                                <Text text="Опер."/>
                                            </header>
                                        </Column>
                                        <Column width="30em">
                                            <header>
                                                <Text text="Значения"/>
                                            </header>
                                        </Column>
                                    </columns>
                                    <ColumnListItem>
                                        <Text text="{attr}"/>
                                        <Text text="{oper}"/>
                                        <Text text="{val}"/>
                                    </ColumnListItem>
                                </Table>
                            </Panel>
                        </IconTabFilter>
                    </items>
                </IconTabBar>
            </content>
            <footer>
                <Toolbar>
                    <Button text="Назад" id="buttonPrev" icon="sap-icon://navigation-left-arrow" press="onPressNavigate" visible="false"/>
                    <ToolbarSpacer/>
                    <Button
                        text="Далее"
                        id="buttonNext"
                        icon="sap-icon://navigation-right-arrow"
                        iconFirst="false"
                        press="onPressNavigate"/>
                    <Button
                        text="Сохранить"
                        id="buttonSave"
                        icon="sap-icon://save"
                        press="onPressSave"
                        type="Accept"
                        visible="false"
                        enabled="{editable>/editable}"/>
                </Toolbar>
            </footer>
        </Page>
    </App>
</mvc:View>
